---
# type: docs
title: â™Š [Geminocks] La batteria del mio MacðŸ”‹ su Google Cloud Monitoring â€” invia SMS se bassa ðŸª«
date: 2022-11-09T11:48:51+01:00
featured: false
draft: false
comment: true
toc: true
reward: true
pinned: false
carousel: false
series:
categories: []
tags: [GCP, macbook, SMS, pager, medium, symlink]
images:
- /images/articles/london-airport.jpg
meta_image: featured-sample.jpg # This is for ZZO
#- /images/battery-life-cli.webp
#- /images/london-airport.jpg
# original TODO more from https://medium.com/google-cloud/my-macs-battery-on-google-cloud-monitoring-with-sms-if-its-low-a1ccd70485fe
---

<!-- this works: ![Image Caption](/images/riccardo.jpg "Use Image Title as Caption aeroporto") -->
![Image Caption](/images/articles/london-airport.jpg "[HUGO] Prendendo un treno per l'aeroporto cittadino, il mio aeroporto preferito a Londra")


Questo articolo mostra come puoi facilmente iniettare una chiave/valore generica in Google Cloud Monitoring e impostare avvisi su di essa. Lo uso per avvisare sullo spazio su disco e ora anche sulla batteria scarica!

Stamattina ero a Londra e mi sono dimenticato il caricabatterie a casa. Con un sacco di tempo ma ðŸª« poca batteria, ho pensato: ehi! Devo avere un modo per prevedere quando la mia batteria Ã¨ scarica! E devo farlo in un modo totalmente esagerato!

<!--more-->

La mia batteria era al 42%, il che sembrava una sottile indicazione che la mia idea valeva la pena di essere pubblicata sul blog. Cercando su Google, ho trovato un articolo che mi ha dato il suggerimento su come scrivere la batteria del mio Mac (nota che questo funziona solo per un Macbook).

Codice brutto qui (ehi! Sono in un aeroporto senza caricabatterie, vuoi anche i test unitari?!?)

```ruby
#!/usr/bin/env ruby

# Note1. buridone is currently not used. It's for a more efficient use to extrapolate all info from a single file read.
# Note2. This does NOT work on M1. I've just fixed this in the github repo sakura. Find the updated 0.2 code there.
def processMacCapacity(buridone)
  ret = {}
  ret[:debug] = 'Will fill numerator and denominator until I nail it.'
  ret[:capacity_pct] = 142 # clearlly wrong
  # `ioreg -l -w0 | grep AppleRawMaxCapacity`.split
  # => ["|", "|", "\"AppleRawMaxCapacity\"", "=", "4320"]
  ret[:AppleRawMaxCapacity] = `ioreg -l -w0 | grep AppleRawMaxCapacity`.split[4].to_i
  ret[:AppleRawCurrentCapacity] = `ioreg -l -w0 | grep AppleRawCurrentCapacity`.split[4].to_i
  #  => ["\"StateOfCharge\"=41"]
  ret[:StateOfCharge] = `ioreg -l -w0 | grep BatteryData`.split(',').select{|e| e.match /StateOfCharge/ }[0].split('=')[1].to_i
  ret[:AppleDesignCapacity] = `ioreg -l -w0 | grep BatteryData`.split(',').select{|e| e.match /DesignCapacity/ }[0].split('=')[1].to_i

  # derived values..
  # this should be your battery life i guess?x
  ret[:BatteryCapacityPercent] = ret[:AppleRawCurrentCapacity]*100.0/ret[:AppleRawMaxCapacity]
  ret[:battery_health] =  ret[:AppleRawMaxCapacity]*100.0/ret[:AppleDesignCapacity]

  return ret
end

def real_program
  capacity_hash = processMacCapacity(`ioreg -l -w0 | grep Capacity`)
  deb "capacity_hash: '''#{white capacity_hash}'''"
  if $DEBUG
    capacity_hash.each{|k,v|
      puts "[DEB] #{k}:\t#{v}"
  }
  end
  puts "1. ðŸ”‹ BatteryLife % ðŸ”ŒðŸª«: #{capacity_hash[:BatteryCapacityPercent].round(2)}"
  puts "2. ðŸ”‹ BatteryHealth % ðŸ›Ÿ: #{capacity_hash[:battery_health].round(2)}"
end

def main(filename)
  deb "I'm called by #{white filename}"
  init        # Enable this to have command line parsing capabilities!
  real_program
end

main(__FILE__)
```


Lo so, chiamo lo stesso comando 10 volte e potrei metterlo in cache. Questo Ã¨ per la prossima iterazione!

La parte migliore di questo Ã¨ che non solo ottengo la durata della batteria, ma mi fornisce anche la durata della batteria, quindi quando devo cambiare la batteria. Woohoo!

Ecco fatto, proviamolo, lasciami solo rimuovere il cavo in modo che tu non abbia un noioso 100%.

![Image Caption](/images/articles/battery-life-cli.webp "Ecco la durata della mia batteria e la salute della mia batteria")

TODO(ricc): finish


[Vedi articolo su Medium](https://medium.com/google-cloud/my-macs-battery-on-google-cloud-monitoring-with-sms-if-its-low-a1ccd70485fe)




*(Generated by Geminocks: https://github.com/palladius/ricc.rocks/tree/main/gemini prompt_version=1.3)*