---
# type: docs
title: "ğŸ‡«ğŸ‡· â™Š [Geminocks] La batterieğŸ”‹ de mon Mac sur Google Cloud Monitoring â€” envoi de SMS si elle est faible ğŸª«"
date: 2022-11-09T11:48:51+01:00
featured: false
draft: false
comment: true
toc: true
reward: true
pinned: false
carousel: false
series:
categories: [ GCP, Work ]
tags: [GCP, macbook, SMS, pager, medium, geminocks, French ]
images:
- /images/articles/london-airport.jpg
meta_image: featured-sample.jpg # This is for ZZO
#- /images/battery-life-cli.webp
#- /images/london-airport.jpg
# original TODO more from https://medium.com/google-cloud/my-macs-battery-on-google-cloud-monitoring-with-sms-if-its-low-a1ccd70485fe
---

<!-- this works: ![Image Caption](/images/riccardo.jpg "Use Image Title as Caption aeroporto") -->
![Image Caption](/images/articles/london-airport.jpg "[HUGO] Prendre un train pour City Airport, mon aÃ©roport prÃ©fÃ©rÃ© Ã  Londres")


Cet article montre comment vous pouvez facilement injecter une clÃ©/valeur gÃ©nÃ©rique dans Google Cloud Monitoring et configurer des alertes dessus. Je l'utilise pour alerter sur l'espace disque, et maintenant aussi sur la batterie faible !

Ce matin, j'Ã©tais Ã  Londres et j'ai oubliÃ© mon chargeur Ã  la maison. Avec beaucoup de temps mais ğŸª« peu de batterie, j'ai pensÃ© : hÃ© ! J'ai besoin d'un moyen de prÃ©voir quand ma batterie est faible ! Et j'ai besoin de le faire d'une maniÃ¨re totalement exagÃ©rÃ©e !

<!--more-->

Ma batterie Ã©tait Ã  42%, ce qui semblait Ãªtre une indication subtile que mon idÃ©e valait la peine d'Ãªtre publiÃ©e. En cherchant sur Google, j'ai trouvÃ© un article qui m'a donnÃ© l'astuce pour scripter la batterie de mon Mac (notez que cela ne fonctionne que pour un Macbook).

Code moche ici (hÃ© ! Je suis dans un aÃ©roport sans chargeur, vous voulez des tests unitaires aussi ? ! ?)

```ruby
#!/usr/bin/env ruby

# Note1. buridone n'est actuellement pas utilisÃ©. C'est pour une utilisation plus efficace afin d'extrapoler toutes les informations Ã  partir d'une seule lecture de fichier.
# Note2. Cela ne fonctionne PAS sur M1. Je viens de corriger cela dans le rÃ©fÃ©rentiel github sakura. Trouvez le code 0.2 mis Ã  jour lÃ -bas.
def processMacCapacity(buridone)
  ret = {}
  ret[:debug] = 'Remplira le numÃ©rateur et le dÃ©nominateur jusqu'Ã  ce que je le cloue.'
  ret[:capacity_pct] = 142 # clairement faux
  # `ioreg -l -w0 | grep AppleRawMaxCapacity`.split
  # => ["|", "|", "\"AppleRawMaxCapacity\"", "=", "4320"]
  ret[:AppleRawMaxCapacity] = `ioreg -l -w0 | grep AppleRawMaxCapacity`.split[4].to_i
  ret[:AppleRawCurrentCapacity] = `ioreg -l -w0 | grep AppleRawCurrentCapacity`.split[4].to_i
  #  => ["\"StateOfCharge\"=41"]
  ret[:StateOfCharge] = `ioreg -l -w0 | grep BatteryData`.split(',').select{|e| e.match /StateOfCharge/ }[0].split('=')[1].to_i
  ret[:AppleDesignCapacity] = `ioreg -l -w0 | grep BatteryData`.split(',').select{|e| e.match /DesignCapacity/ }[0].split('=')[1].to_i

  # valeurs dÃ©rivÃ©es..
  # cela devrait Ãªtre la durÃ©e de vie de votre batterie, je suppose ?x
  ret[:BatteryCapacityPercent] = ret[:AppleRawCurrentCapacity]*100.0/ret[:AppleRawMaxCapacity]
  ret[:battery_health] =  ret[:AppleRawMaxCapacity]*100.0/ret[:AppleDesignCapacity]

  return ret
end

def real_program
  capacity_hash = processMacCapacity(`ioreg -l -w0 | grep Capacity`)
  deb "capacity_hash: '''#{white capacity_hash}'''"
  if $DEBUG
    capacity_hash.each{|k,v|
      puts "[DEB] #{k}:\t#{v}"
  }
  end
  puts "1. ğŸ”‹ Autonomie de la batterie % ğŸ”ŒğŸª«: #{capacity_hash[:BatteryCapacityPercent].round(2)}"
  puts "2. ğŸ”‹ SantÃ© de la batterie % ğŸ›Ÿ: #{capacity_hash[:battery_health].round(2)}"
end

def main(filename)
  deb "Je suis appelÃ© par #{white filename}"
  init        # Activez ceci pour avoir des capacitÃ©s d'analyse de ligne de commande !
  real_program
end

main(__FILE__)
```


Je sais, j'appelle la mÃªme commande 10 fois et je pourrais la mettre en cache. C'est pour la prochaine itÃ©ration !

Le meilleur dans tout Ã§a, c'est que non seulement j'obtiens l'autonomie de ma batterie, mais cela me donne Ã©galement sa durabilitÃ© - donc quand j'ai besoin de changer de batterie. Youpi !

VoilÃ , essayons, laissez-moi juste retirer le cÃ¢ble pour que vous n'obteniez pas un 100% ennuyeux.

![Image Caption](/images/articles/battery-life-cli.webp "Voici l'autonomie de ma batterie et la santÃ© de ma batterie")

TODO(ricc): terminer


[Voir l'article sur Medium](https://medium.com/google-cloud/my-macs-battery-on-google-cloud-monitoring-with-sms-if-its-low-a1ccd70485fe)


*(Generated by Geminocks: https://github.com/palladius/ricc.rocks/tree/main/gemini prompt_version=1.4)*